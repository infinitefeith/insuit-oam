



  6Man工作组G. Fioccolainternet-Srift T. Zh
ouptended状态：标准轨道Huaweiexpires：3月18日，2022
M. Cociglio Telecom Italia F.秦中国移动R.
Pang中国联通2011年9月14日9月14日

  IPv6替代标记方法的应用牵线IETF-6Man-IPv6-Alt-
Mark-10

  抽象的

  本文档介绍了如何将备用标记方法用作IPv6域中的被动性能测量工具。它定义了一
个新的扩展标题选项，可在跳通选项标题和目标选项标题中编码备用标记信息。

  这个备忘录的地位

  此互联网草案与BCP 78和BCP 79的规定完全一致。

  互联网草稿是互联网工程工作组（IETF）的工作文件。请注意，其他组还可以将工
作文件分发给互联网草稿。当前的Internet-草稿列表是https://dat
atracker.ietf.org/drafts/current/。

  互联网草案均缴纳最多六个月的文件草案，并可以随时更新，更换或已被其他文件替换
或过时。使用互联网草稿作为参考资料是不合适的，或者以“正在进行的工作”。

  此互联网草案将于2022年3月18日到期。

  版权声明

  版权所有（c）2021 IETF信托和被确定为文件作者的人。版权所有。

  本文件须遵守BCP 78和IETF Trust与IETF文件（HTTPS:/
/trustee.ietf.org/LICENSE-INFO）的法律规定有效期



Fioccola, et al.         Expires March 18, 2022                 [Page 1]

Internet-Draft                  IPv6 AMM                  September 2021

  发布本文件。请仔细审查这些文件，因为它们描述了对本文件的权利和限制。从本文档
中提取的代码组件必须包括简化的BSD许可证文本，如信托法律规定第4.在第41条中
所述，并且在没有简化的BSD许可证中所述没有保修提供。

  目录

   1.  Introduction  . . . . . . . . . . . . . . . . . . . . . . . .   2
     1.1.  Terminology . . . . . . . . . . . . . . . . . . . . . . .   3
     1.2.  Requirements Language . . . . . . . . . . . . . . . . . .   3
   2.  Alternate Marking application to IPv6 . . . . . . . . . . . .   3
     2.1.  Controlled Domain . . . . . . . . . . . . . . . . . . . .   5
       2.1.1.  Alternate Marking Measurement Domain  . . . . . . . .   6
   3.  Definition of the AltMark Option  . . . . . . . . . . . . . .   7
     3.1.  Data Fields Format  . . . . . . . . . . . . . . . . . . .   7
   4.  Use of the AltMark Option . . . . . . . . . . . . . . . . . .   8
   5.  Alternate Marking Method Operation  . . . . . . . . . . . . .  10
     5.1.  Packet Loss Measurement . . . . . . . . . . . . . . . . .  10
     5.2.  Packet Delay Measurement  . . . . . . . . . . . . . . . .  12
     5.3.  Flow Monitoring Identification  . . . . . . . . . . . . .  13
       5.3.1.  Uniqueness of FlowMonID . . . . . . . . . . . . . . .  15
     5.4.  Multipoint and Clustered Alternate Marking  . . . . . . .  15
     5.5.  Data Collection and Calculation . . . . . . . . . . . . .  16
   6.  Security Considerations . . . . . . . . . . . . . . . . . . .  16
   7.  IANA Considerations . . . . . . . . . . . . . . . . . . . . .  19
   8.  Acknowledgements  . . . . . . . . . . . . . . . . . . . . . .  20
   9.  References  . . . . . . . . . . . . . . . . . . . . . . . . .  20
     9.1.  Normative References  . . . . . . . . . . . . . . . . . .  20
     9.2.  Informative References  . . . . . . . . . . . . . . . . .  20
   Authors' Addresses  . . . . . . . . . . . . . . . . . . . . . . .  22

1.介绍

  [RFC8321]和[RFC8889]描述了一种被动性能测量方法，可用于测量
实时流量上的数据包丢失，延迟和抖动。由于该方法基于标记连续的分组，因此该方法通常
被称为备用标记方法。

  本文档定义了备用标记方法如何用于测量IPv6中的性能度量。理由是将替代标记方
法应用于IPv6，因此允许逐跳和端到端的详细数据包丢失，延迟和延迟变化测量，以确
切地定位IPv6网络中的问题。





Fioccola, et al.         Expires March 18, 2022                 [Page 2]

Internet-Draft                  IPv6 AMM                  September 2021

  替代标记是路径遥测技术，包括通过切换标记比特的值并因此将分组流除以批次来同步
网络的不同点中的测量。每个批处理代表沿路径的所有网络节点识别的可测量实体。通过计
算每批中的分组数并进行比较不同节点测量的值，可以精确测量分组丢失。类似地，标记比
特的值的交替可以用作计算延迟和延迟变化的时间参考。在第5节中进一步描述替代标记操
作。

  IPv6地址的格式在[RFC4291]中定义，而[RFC8200]定义IPv
6报头，包括20位流标签和IPv6扩展头。

  本文档引入了新的TLV（类型长度值），可以在IPv6域中的备用标记方法应用程
序在选项标题（跳跃或目标）中编码。

  在第6节中报告了在IPv6域中应用替代标记方法的威胁模型。与所有开放的遥测技
术一样，唯一的确定解决方法是该方法必须应用于受控域。

1.1。术语

  本文档使用与[RFC8321]和[RFC8889]中定义的备用标记方法相关的
术语。

1.2。要求语言

  关键词“必须”，“必须”，“必填”，“应该”，“不得”，“应该”，“应该”，
“推荐”，“不推荐”，“可以”，和“可选“在本文档中将被解释为如BCP 14
[RFC2119]
[RFC8174]何时所述，并且仅当它们出现在所有资本中时，如此所示。

2.替代标记应用于IPv6

  备用标记方法需要标记字段。可以考虑几种替代方案，例如IPv6扩展标题，IPv
6地址和流标。但是，有必要分析所有可用可能性的缺点，更具体地说：

  为备用标记重用现有的扩展标题导致未优化的实施;




Fioccola, et al.         Expires March 18, 2022                 [Page 3]

Internet-Draft                  IPv6 AMM                  September 2021

  使用IPv6目的地址来编码备用标记处理非常昂贵;

  使用IPv6流标记用于交替标记冲突，利用负载分配目的的流标签（[RFC643
8]）。

  最后，逐跳或新目的地选项是最佳选择。

  在此备忘录中指定的IPv6的备用标记应用程序的方法符合[RFC8200]。它
涉及以下操作：

  o源节点是唯一一个将选项标题写入以交替标记的流量（用于逐跳和目标选项）。中间
节点和目标节点必须只读取选项的标记值而不修改选项标题。

  o在携带备用标记位的逐跳选项标题的情况下，它不会插入或删除，但可以沿路径的任
何节点读取。中间节点可以被配置为支持该选项，而且可以仅针对被配置为读取该选项的节
点来完成测量。如第4节中进一步讨论的，逐跳选项的存在不应影响在不识别此选项的节点
上以及支持它的节点上的流量吞吐量。但是，值得一提的是理论与实践之间存在差异。实际
上，在真实的实现中，也可以在慢路上跳过或处理具有逐跳选项的数据包。虽然一些提议正
在尝试解决这个问题并使逐跳选项更加实用（[ID.peng-v6ops-
hbh]，[id.hinden-6man-hbh-
processing]），这些方面是超出范围对于这份文件。

  o在目的地选项标题携带备用标记位的情况下，它不会被沿着路径的任何节点处理，插
入或删除，直到数据包到达目标节点。请注意，如果还有路由标题（RH），则路由列表中
的任何访问目标都可以处理选项标题。

  Hop-By-Hop选项标题对于在路径上的路由器中也有用，以处理备用标记。但
是，如上所述，如果正确配置，则路由器只会检查此选项。

  还考虑了替代标记方法的实现和缩放的优化，并且识别流动的方法是



Fioccola, et al.         Expires March 18, 2022                 [Page 4]

Internet-Draft                  IPv6 AMM                  September 2021

  必需的。流动监测识别场（流动），如第5.3节中引入，沿此方向进行，它用于识别
受监控的流程。

  流窗不同于IPv6报头的流量标签场（[RFC6437]）。 IPv6报头中的
流标签字段由源代码用于将要在网络中处理的分组序列标记为单个流量，如[RFC643
8]中报告，它可用于负载平衡/等于成本多路径（LB / ECMP）。不考虑用于识
别监控流的流标签字段的重用，因为它可能会改变应用程序意图和转发行为。此外，可以改
变流标签的路线，这也可以使测量的完整性无效。此外，由于流量标签是伪随机的，因此始
终存在有限的碰撞概率。这些原因使IPv6所需的流动性定义。实际上，流窗是设计的并
且仅用于识别受监测的流动。在同一数据包内的流标签和FlowMonid完全不相交，
具有不同的范围，用于基于不同标准识别流量，并且旨在用于不同的用例。

  在5.3节中进一步讨论了该局部的基本原理。该20位字段允许容易灵活地识别受监
控的流量，并实现了改进的测量相关性和更精细的粒度，因为它可以与传统的TCP /
IP 5元组合使用以识别流量。将在第5.3.1节中讨论的一个重要点是狭窄的唯一性
以及如何在碰撞时允许歧义的歧扇。

  以下部分突出显示将替代标记应用于IPv6的重要要求。解释了受控域的概念，并且
被认为是一个基本的前提，如第6节中的突出显示。

2.1。控制领域

  [RFC8799]介绍了特定有限域解决方案的概念，并且在这方面，报告了IPv
6作为示例的替代标记方法的应用。

  IPv6具有比IPv4更具灵活性，并提出了创新应用程序，但由于许多原因，例如
策略，支持的选项，网络管理和安全要求的风格，建议将其中一些应用程序限制在受控中领
域。这也是下面假定的IPv6的交替标记应用的情况。





Fioccola, et al.         Expires March 18, 2022                 [Page 5]

Internet-Draft                  IPv6 AMM                  September 2021

  因此，必须在受控域中部署备用标记方法的IPv6应用。建议携带备用标记数据并进
入或离开受控域的实施过滤器分组。

  受控域是托管网络，其中需要通过在域边界处强制执行策略来选择，监视和控制对网络
的访问，以便丢弃输入域的不期望的外部数据包，并检查离开域的内部数据包。它并不一定
意味着受控域是单个管理域或单个组织。受控域可以对应于单个管理域，或者可以在定义的
网络管理下由多个管理域组成。实际上，一些方案可能意味着备用标记方法涉及多个域，但
在这些情况下，建议通过使用IPsec [RFC4301]认证和加密或其他域来创建
多个域在遍历外部域时创建整个控制域VPN技术提供完整的数据包机密性和完整性保护。
在几个单词中，如果流量遍历Internet，则必须控制域边界并最终使用特定的预防
措施。

  第6节报告的安全考虑因素还突出了这一要求。

2.1.1。备用标记测量域

  替代标记测量域可以与受控域重叠，或者可以是受控域的子集。应用替代标记方法的典
型方案依赖于受控域边界，特别是：

  用户设备可以是启动或结束节点，只有在完全管理的情况下，如果它属于受控域。在这
种情况下，用户生成的IPv6数据包包含备用标记数据。但是，在实践中，由于用户设备
不能完全安全地在大多数情况下完全安全起见，这并不常见。

  CPE（客户驻地设备）最有可能是启动或结束节点，因为它将用户的房屋与服务提供
商的网络连接，因此属于操作员的受控域。通常，CPE封装在包含备用标记数据的外部I
Pv6报头中的接收分组。CPE还可以使用不一致的字段从域外面过滤和删除数据包，以
便在域中生效相关的安全规则



Fioccola, et al.         Expires March 18, 2022                 [Page 6]

Internet-Draft                  IPv6 AMM                  September 2021

  边界，例如简单的安全检查可以是才能插入备用标记数据（如果目的地在受控域内）。

3. Altmark选项的定义

  下面报告了携带专用于备用标记方法的数据字段的选项扩展标题的新TLV的定义。

3.1。数据字段格式

  下图显示了增强备用标记TLV（ALTMark）的数据字段格式。此Altmar
k数据可以封装在IPv6选项标题（跳通或目标选项）中。

    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
                                   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
                                   |  Option Type  |  Opt Data Len |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |              FlowMonID                |L|D|     Reserved      |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+



  o Option Type : 需要分配的选项类型的8位标识符。在处理时必须
忽略未识别的类型。对于逐跳选项标题或目标选项标题，[RFC8200]定义了如何编
码选项类型字段的三个高阶位。两种高阶位指定了如果处理IPv6节点无法识别选项类型
，则指定必须采取的操作;对于Altmark，这两个位必须设置为00（跳过此选项并
继续处理标题）。第三位阶位指定选项数据是否可以将途中更改为数据包的最终目标;对于
Altmark，必须将此位的值设置为0（选项数据不会更改EN Route）。这样
，由于AltMark选项的三个高阶位设置为000，这意味着如果它们无法识别，则节
点可以简单地跳过此选项，并且此选项的数据不会更改在路由中，但实际上是源是唯一可以
写它的人。

  o Opt Data Len :
4.此选项的选项数据字段的长度以字节为单位。





Fioccola, et al.         Expires March 18, 2022                 [Page 7]

Internet-Draft                  IPv6 AMM                  September 2021

  o FlowMonID : 20位无符号整数。流函数标识符在第5.3节中描述
。如下面进一步讨论的，它已被选中为20位，因为如果通过源节点随机设置伪或由集中控
制器设置，则相对于碰撞的机会是合理的值和良好的折衷。

  o L : 如5.1节所述的丢包标志用于丢包测量;

  o D : 单分组延迟测量的延迟标志如第5.2节所述;

  o Reserved :
保留未来使用。这些位必须在传输上设置为零，并在收到时忽略。

4.使用ALTMARK选项

  AltMark选项是实现备用标记方法的最佳方法，它由跳跃选项标题和目标选项标
题携带。在目标选项的情况下，它仅由源和目标节点处理：源节点插入和目标节点处理它。
虽然，在逐跳选项的情况下，如果明确配置为执行此操作，则可以通过路径的任何节点检查
它。

  重要的是要突出显示选项布局，也可以根据用例，作为跳跃选项，并且它基于所选择的
性能测量类型。通常，需要通过跳测量执行结束并跳跃，并且替代标记方法允许根据性能测
量。在许多情况下，端到端的测量是不够的，并且需要跳跃测量，因此最完整的选择可以是
逐跳选项标题。

  IPv6，如[RFC8200]中规定，允许节点可选地处理逐跳标头。具体而言，
未插入或删除逐跳选项标题，但是可以沿着分组的传送路径的任何节点检查或处理，直到数
据包到达节点（或每个节点集中的每个节点，在多播的情况下）在IPv6标题的目标地址
字段中标识。此外，预计沿着分组的传送路径的节点仅检查和处理逐跳选项标题，如果明确
配置为这样做。

  可以提及的另一种场景是存在路由报头，特别是可以考虑SRV6。已成为一种新类型
的路由标题，称为段路由标题（SRH），已成为



Fioccola, et al.         Expires March 18, 2022                 [Page 8]

Internet-Draft                  IPv6 AMM                  September 2021

  定义为SRV6的[RFC8754]。与IPv6的任何其他用例一样，当存在SR
V6标题时，可以使用逐跳和目标选项。因为SRV6通过段路由报头（SRH）实现，所
以路由报头在路由列表中处理之前的目的地选项，其在SRH的情况下由SR路径识别的每
个SR节点在于SRH的情况下。有关SRV6应用程序的更多详细信息在[I-D.FZ
-Spring-SRV6-Alt-Mark]中描述。

  总之，可以列出替代可能性：

  o目标选项未在路由标题之前=>仅按目标地址中的节点测量。

  O HOP-BET-HOP选项=>通过功能的路径上的每个路由器启用。

  O路由标题的目标选项=>路由列表中的每个目标节点。

  通常，逐跳和目的地选项是实现替代标记的最合适的方法。

  值得一提的是，在[RFC7045]和[RFC8200]中没有强烈建议新的逐跳
选项，除非有明确的理由来标准化它，因为可以将节点配置为忽略选项标题，删除或分配数
据包包含慢速处理路径的选项标题。如果在本文档中描述的AltMark数据字段，则标
准化新跳跃选项的动机是OAM所需的（操作，管理和维护）。中间节点可以读取它，但这
不会影响数据包行为。源节点是唯一一个写入的跳跃选项以交替标记的流量，因此，可以为
被配置为读取此选项的那些节点来完成性能测量，而其他节点则根本不考虑指标。

  本文档中定义的逐跳选项旨在利用如何处理逐跳选项的属性。不支持此选项的节点应该
忽略它们。这可能意味着，在这种情况下，性能测量不会沿着路径的所有链路和节点解释。
本文档中的逐跳选项的定义还旨在最小化在不识别支持它的节点上的节点上的吞吐量影响。
实际上，本草案中定义的选项标题的三个高阶位是000，理论上，根据[RFC8200
]和[id.hinden-6man-hbh-procession]，这意味着“跳
过如果不识别和数据不会在路线上更改“。[RFC8200]也提到了



Fioccola, et al.         Expires March 18, 2022                 [Page 9]

Internet-Draft                  IPv6 AMM                  September 2021

  如果明确配置为这样做，节点仅检查和处理逐跳选项标题。由于这些原因，此逐跳选项
不应影响吞吐量。但是，在实践中，重要的是要意识到，在实现中可能不同，它可能会发生
具有跳跃的数据包被强制到慢速路径上，但这也是一般问题，也可以解释[id.hind
en-6man-hbh加工]。值得一提的是，对受控域的应用应该避免随着逐跳选项丢
弃分组的任意节点的风险。

5.交替标记方法操作

  本节介绍该方法如何运行。[RFC8321]介绍了以下几种适用的方法，如下所示
，并引入了一个新领域，以便于部署并提高可扩展性。

5.1。数据包丢失测量

  与现有机制相比，数据包丢失的测量非常简单，如[RFC8321]中详述。流程的
分组被分组成批次，并且通过将L位（损耗标志）设置为相同的值来标记批次内的所有分组
。在固定数量的分组或根据固定定时器之后，源节点可以切换0到1之间的L位的值，这取
决于实现。源节点是标记数据包创建批次的唯一一个，而中间节点仅读取标记值并识别分组
批次。通过计算每批中的分组数并进行比较沿着路径的不同网络节点测量的值，可以测量在
任意两个节点之间的任何单个批处理中发生的分组丢失。每个批处理代表沿路径的所有网络
节点识别的可测量实体。

  源节点可以使用固定数量的数据包和固定定时器来创建数据包批次。但是，也如在[R
FC8321]中解释的，所以基于定时器的批次是优选的，因为它们比基于计数的批量更
确定。与基于定时器的批次不同的基于计数批次没有明确的规则。对于交换机的固定定时器
提供更好地对该方法的控制，实际上可以选择批次的长度足以简化集合和不同网络节点所采
取的措施的比较。在实现中，可以将每个节点发送到负责计算的控制器中的计数器。还可以
通过使用其他路径技术来交换此信息。但这是本文件的范围。




Fioccola, et al.         Expires March 18, 2022                [Page 10]

Internet-Draft                  IPv6 AMM                  September 2021

  具有不同L值的数据包可以在批处理边界上交换，并且在这种情况下，需要每个标记的
数据包都可以被每个路由器分配给右批处理。重要的是要提及应用此方法有两个要考虑的元
素：网络节点与网络延迟之间的时钟误差。这些可以在批处理和数据包的outlow之间
创建偏移。必须满足[RFC8321]的第3.2节中解释的时序方面的数学公式，并考
虑到时钟误差和网络延迟等重新排序的不同原因。假设是定义可用的计数间隔，从中获得稳
定的计数器并避免这些问题。具体地，如果忽略网络延迟的影响，则实现方法的条件是，不
同节点中的时钟必须与/  -  B / 2时间单位的精度同步到相同的时钟参考，其
中B是固定时间批量的持续时间，这指的是源节点处的原始标记间隔，考虑到该间隔可能沿
着路径波动。以这种方式，每个标记的数据包都可以被每个节点分配给右批处理。通常，计
数器可以在批处理期间拍摄，以确保静止柜台。在几句句话句，这意味着必须足够大的批次
的长度，以便该方法不受这些因素的影响。可以基于特定的部署方案确定批次的长度。


   L bit=1   ----------+           +-----------+           +----------
                       |           |           |           |
   L bit=0             +-----------+           +-----------+
              Batch n        ...      Batch 3     Batch 2     Batch 1
            <---------> <---------> <---------> <---------> <--------->

                                Traffic Flow
            ===========================================================>
   L bit   ...1111111111 0000000000 11111111111 00000000000 111111111...
            ===========================================================>

  Figure 1 : 使用L位的数据包丢失测量和单标方式

  值得一提的是，批次的持续时间在前一个数字中被认为是稳定的。理论上，可以随着时
间的推移和不同流量来改变批次的长度以获得更多的灵活性。但是，在实践中，它可以使信
息的相关性复杂化。





Fioccola, et al.         Expires March 18, 2022                [Page 11]

Internet-Draft                  IPv6 AMM                  September 2021

5.2。数据包延迟测量

  用于测量分组丢失的相同原理也可以应用于单向延迟测量。可以使用两种可能性计算延
迟度量：

1. Single-Marking Methodology : 此方法仅使用l位
来计算分组丢失和延迟。在这种情况下，D标志必须在发送和监视点忽略时将其设置为零。
L位值的交替可以用作计算延迟的时间参考。每当L位改变和新批处理开始时，网络节点可
以存储新批处理的第一个数据包的时间戳，该时间戳可以与第二节点上相同批处理的第一个
数据包的时间戳进行比较，以计算数据包延迟。但是，只有在没有发生数据包丢失并且如果
在批次边缘处没有数据包重新排序，则此测量才准确。也可以考虑不同的方法，并且它基于
平均延迟的概念。通过考虑分组的平均到达时间来计算每批次的平均延迟。在这种情况下也
有局限性，每个节点都需要收集所有时间戳并计算每个批次的平均时间戳。此外，信息仅限
于平均值。

2. Double-Marking Methodology : 这种方法更加完整
，并且使用L位仅计算丢包，并且D位（延迟标志）完全专用于延迟测量。该想法是使用L
IT的第一个标记来创建备用流程，并且在由L位识别的批处理中，使用第二标记来选择用
于测量延迟的分组。 D位创建一组完全通过网络识别的新标记数据包，以便网络节点可以
存储这些数据包的时间戳;可以将这些时间戳与第二节点上的相同分组的时间戳进行比较，
以计算每个分组的分组延迟值。最有效且强大的模式是为每批选择单个双标数据包，以这种
方式，在双标数据包之间没有时间间隔才能考虑避免其重新排序。关于选择要双标的数据包
的规则，在此处也适用的第5.1节中的相同注意事项，并且可以在可用计数间隔内选择不
受时钟误差等因素影响的可用计数间隔内。如果双色数据包丢失，则所考虑的批次的延迟测
量只是丢弃，但这不是一个大问题，因为它很容易识别出问题批次并仅跳过那个的测量。所
以为了拥有更多




Fioccola, et al.         Expires March 18, 2022                [Page 12]

Internet-Draft                  IPv6 AMM                  September 2021

  有关延迟和克服秩序超出问题的信息，首选此方法。

  总之，具有双标记的方法优于单一标记的方法。此外，这两种方法提供了略微不同的信
息，并且数据消费者可以将它们组合以具有更强大的数据集。

  与分组计数器的第5.1节中所说的类似，在实现中，可以将时间戳发送到负责计算的
控制器，或者也可以使用其他路径技术进行交换。但这是本文件的范围。


   L bit=1   ----------+           +-----------+           +----------
                       |           |           |           |
   L bit=0             +-----------+           +-----------+

   D bit=1         +          +          +          +            +
                   |          |          |          |            |
   D bit=0   ------+----------+----------+----------+------------+-----

                                Traffic Flow
            ===========================================================>
   L bit   ...1111111111 0000000000 11111111111 00000000000 111111111...

   D bit   ...0000010000 0000010000 00000100000 00001000000 000001000...
            ===========================================================>

  Figure 2 : 使用l位和d位的双标方式

  同样地到分组延迟测量（用于单标和双标记），该方法也可用于测量到达间抖动。

5.3。流量监测识别

  流动监测识别（Flowmonid）识别要测量的流程，并且需要有一些一般原因所
需的流量：

  首先，它有助于减少每个节点配置。否则，每个节点需要为每个受监控流配置访问控制
列表（ACL）。此外，使用流量标识允许对流定义的灵活粒度，实际上，它可以与其他标
识符（例如5元组）一起使用。




Fioccola, et al.         Expires March 18, 2022                [Page 13]

Internet-Draft                  IPv6 AMM                  September 2021

  o秒，它简化了柜台处理。流量元组（和ACL匹配）的硬件处理是具有挑战性的，并
且通常会导致性能问题，尤其是在隧道接口中。

  o第三，它可以简化收集器的数据导出封装和相关性。

  必须用作监测流标识符，并且可以使用两个使用模式：

  *仅使用Flofmonid以进行识别目的。这不仅需要易于识别而且改善相关性;

  *使用Flofmonid结合组合来识别流量。这也允许更精细的粒度，因此增加了
流动识别的灵活性。

  流函数标识符字段是确定测量域内的受监视流。建议在实施中使用一致的方法来避免不
同识别方式的混合。因此，沿路径和涉及测量的所有节点应该使用相同的模式进行鉴定（单
独流势或与其他标识符组合）。

  FlowMonID字段位于源节点，该源节点是测量域的入口点，并且可以以两种方
式设置：

  *它可以由中央控制器分配。由于控制器知道网络拓扑，它可以正确设置值以避免或最
小化歧义并保证唯一性。在这方面，控制器可以简单地验证在同一路径上不同的伪随机生成
的流线之间没有模糊性。

  *它可以由源节点算法生成，可以使用一些机会将其伪随机设置。该方法不能保证跨越
跨越的唯一性，但是对于局部或专用网络，可能是优选的，其中由于大的流动空间，冲突概
率很小。

  已经选择了20位的20比特，因为它是一种良好的折衷，并且意味着在大多数应用中
可以被认为可以被认为是可接受的含糊不清的流势率的低速率。实际上，20位组合数量为
1048576。

  如果源节点设定了流阵列，则中间节点可以从飞行中的分组读取流线和动作



Fioccola, et al.         Expires March 18, 2022                [Page 14]

Internet-Draft                  IPv6 AMM                  September 2021

  因此。虽然，如果通过控制器设定函数，则这两种可能性对于可以通过读取分组来学习
的中间节点是可行的，或者可以通过控制器指示。

  当流动空间中的所有值被消耗时，集中控制器可以跟踪并重新分配旧流量不再使用的值
，而如果流线是由源，冲突和冲突的伪。

5.3.1。流动的唯一性

  重要的是要注意，如果20位流势为独立设定并且伪随机地设定有碰撞的机会。实际上
，通过在概率理论中使用众所周知的生日问题，如果20位流势骤流量独立地设定并且无任
何额外的输入熵，则有50％的碰撞机会为1206流。因此，对于更多熵，流动可以与分
组中的其他识别流信息组合（例如，考虑散列的3元组流标签，源和目的地地址）。

  当源节点随机生成窗琴时，该问题更明显，并且需要将其标记为额外的流信息以允许歧
义。虽然，在集中式控制器的情况下，控制器应考虑这些方面并正确指导节点以保证其唯一
性。

  值得注意的是，在大多数应用中，较低的模糊速率可以是可接受的，因为这仅影响测量
。对于大规模测量，在可以监测大量流动的情况下，跨越流场的歧义是要考虑的东西。

5.4。多点和群集备用标记

  替代标记方法也可以扩展到任何类型的多点到多点路径，并且网络聚类方法允许灵活和
优化的性能测量，如[RFC8889]中所述。

  群集是整个网络图的最小可识别子网，仍然满足进入的数据包数的条件是相同的。利用
网络聚类，可以将网络的分区用于不同级别的群集，以便执行所需的细节。因此，对于多点
替代标记，Flofmonid可以识别




Fioccola, et al.         Expires March 18, 2022                [Page 15]

Internet-Draft                  IPv6 AMM                  September 2021

  通常，多点到多点流，不仅是点对点流。

5.5。数据收集和计算

  启用节点以执行性能监视收集数据包计数器和时间戳的值。有几种替代方法来实现数据
收集和计算，但这在本文档中未指定。

  关于交替标记的控制平面机制有文件，例如，[i-d.ietf-idr-sr-
policy-ifit]，[i-d.chen-pce-pcep-ifit]。

6.安全考虑因素

  本文档旨在应用一种方法来执行不会直接影响Internet安全性的测量，也不会
在Internet上运行的应用程序。但是，这种方法的实施必须注意安全和隐私问题。

  有两种类型的安全问题：由测量和对测量的潜在危害引起的潜在伤害。

  Harm caused by the measurement : 备用标记意
味着源节点上的WELF到IPv6数据包的选项标题，但这必须以不改变数据包所经历的
服务质量的方式执行，并保留稳定性和执行测量路由器的性能。如第4节中已讨论，建议A
ltmark选项不会影响吞吐量，从而影响用户体验。

  Harm to the measurement : 替代标记测量可能是通过改
变Altmark选项的字段的路由器损害（例如，数据包，FlowMonID）或通过
恶意攻击者向数据包添加Altmark选项，以便消耗所涉及的网络设备和实体的资源。
如上所述，源节点是唯一一个在中间节点和目的节点时写入选项标题的唯一一个，而不会在
不修改选项标题的情况下读取它。但是，例如，路径攻击者可以修改标志，无论是有意还是
意外地，或故意将新选项插入数据包流程或从分组流中删除该选项。随之而来的效果可以是
通过修改选项标识符（例如跨越函数）来提供丢失或延迟的外观或使测量无效。恶意含义可
以是从网络管理员引起动作，其中不需要干预或隐藏真实问题



Fioccola, et al.         Expires March 18, 2022                [Page 16]

Internet-Draft                  IPv6 AMM                  September 2021

  网络。由于测量本身可能受到有意地改变ALTMARK选项的比特或将选项标题的批
量更改为拒绝服务（DOS）的装置的网络节点来影响，因此必须在网络的上下文中应用备
用标记，其中网络在本地管理节点，可以避免这种类型的攻击。因此，如果没有完全管理并
且不属于受控域，则在结束节点上没有完成该方法的实现。在受控域中生成的数据包可以通
过使用HBH选项恶意使用路由器资源，但可以通过在受控域边界处过滤这些数据包来缓解
这一点。这可以完成，因为如果结束节点不属于受控域，则不应该添加Altmark
HBH选项，并且可以容易地识别。

  流量标识符（flowmonid）与两个标记位（L和D）一起组成Altmark
选项。如第5.3.1节所述，如果晶体是随机设定伪并且存在解决方案，则存在碰撞机会
。一般而言，这可能不是问题，并且可能是可接受的含糊不清的流动性的低速率，因为这对
运营商或其客户没有造成重大危害，这种伤害可能无法证明避免避免的并发症。但是，对于
大规模测量，可以监测大量流动，并且碰撞的概率较高，因此可以考虑流线场的歧义。

  即使该方法仅依赖于选项标题中包含的信息而不发布用户数据，也需要分析隐私问题。
实际上，从保密的角度来看，虽然Altmark选项不包含用户数据，但元数据可以用于
网络侦察，以允许攻击者收集有关网络性能和网络路径的信息来损害用户的隐私。Altm
ark选项包含两种元数据：标记位（L和D位）和流量标识符（flowmonid）。

  标记位是在网络节点之间交换的小信息。因此，由于这种内在特征，通过被动窃听网络
侦察对数据平面流量难以实现。实际上，攻击者无法从单个监视点获取有关网络性能的信息
。攻击者的唯一方法可以同时在多个监视点上窃听，因为它们必须根据替代标记进行相同的
计算和聚合。

  跨越字段用于ALTMARK选项作为监控流的标识符。它代表更敏感



Fioccola, et al.         Expires March 18, 2022                [Page 17]

Internet-Draft                  IPv6 AMM                  September 2021

  网络侦察信息，可以允许流动跟踪类型的攻击类型，因为攻击者可以收集有关网络路径
的信息。

  此外，在普遍存在的监视攻击中，可以随着时间推出的信息更多。但是，如下文中进一
步描述，将替代标记应用于受控域有助于减轻隐私问题的所有上述方面。

  在管理平面上，可以通过错误配置或通过恶意配置Altmark选项来设置攻击。因
此，必须以验证授权用户的方式保护Altmark选项配置，并验证配置过程的完整性。
解决方案以确保AltMark选项的完整性超出本文档的范围。此外，对监视点和网络管
理系统之间的统计数据报告的攻击（例如集中式控制器）可以干扰系统的正常运行。因此，
必须确保用于报告回到流统计信息的频道。

  如上所述，应用替代标记的前提是它必须在特定的控制域中应用，从而限制网络域内的
潜在攻击向量。 [RFC8799]分析并讨论只能在有限域内应用的网络行为的趋势。
这是由于特定的要求，特别是与支持的安全性，网络管理，策略和选项相关的要求，这可能
会在此类有限域之间变化。有限的管理域提供网络管理员，其中包含选择，监视和控制对网
络的访问，使其成为可信域。在这方面，预计将在域边界处强制执行策略，以使用Altm
ark选项对外数据包使用AltMark选项离开域，将域和内部数据包离开域。因此，
由于处理具有AltMark选项的数据包并仅在受控域内处理并仅使用，因此可信域不太
可能受到数据包的劫持。

  如上所述，应用于受控域的应用程序确保控制进入和离开域的数据包，但尽管如此，可
能出于不同的原因可能发生泄漏，例如故障或故障。在这种情况下，域之外的节点必须简单
地忽略具有Altmark选项的数据包，因为它们不应该处理它。

  另外，要注意的是，Altmark选项由选项标题承载，它可能对监视流的数据包大
小和路径MTU对数据包大小产生一些影响，因为某些分组可能超过MTU。但是，相对小
的尺寸（总共48位）




Fioccola, et al.         Expires March 18, 2022                [Page 18]

Internet-Draft                  IPv6 AMM                  September 2021

  这些选项标题及其应用于受控域的应用帮助以减轻问题。

  值得一提的是，安全问题可能会根据具体部署方案和相关威胁分析而改变，这可能导致
超出本文档范围的特定安全解决方案。作为示例，AltMark选项可以用作跳跃或目标
选项，并且在目标选项的情况下，可以由不限于单个管理域的Altmark选项来遍历多
个管理域。在这种情况下，用户意识到这种风险的类型，可能仍然希望为遥测和测试目的使
用备用标记，但是控制域必须由多个管理域组成。为此，需要保护域间链接（例如，通过I
Psec，VPN）以避免外部威胁并实现整个受控域。

  理论上可以理解地调制Altmark选项的标记或其他字段，以用作路径观察者的封
面信道。这可能会影响数据和管理平面，但是，在这里，对受控域的应用程序有助于减少效
果。

  本文档中描述的备用标记应用程序依赖于时间同步协议。因此，通过攻击时间协议，攻
击者可能潜在地损害测量的完整性。[RFC7384]介绍了关于对时间协议的威胁以及
如何减轻它们的详细讨论。网络时间安全（NTS），在[RFC8915]中描述，是可
以采用的机制。此外，通过时间协议分发到网络节点的时间是从外部准确的时间源的集中的
，例如原子钟或GPS时钟。通过攻击时间源，可以危及测量的完整性。有可能采取的安全
措施，以缓解GPS欺骗攻击，网络管理员肯定会采用解决方案来保护网络域。

7. IANA考虑因素

  选项类型应在IANA的“目标选项和跳跃选项”注册表中分配。

  此草案请求以下IPv6选项类型分配从目标选项和跳跃选项Internet协议版
本6（IPv6）参数的子注册表（https://www.iana.org/asn
ignments/ipv6-parameters/）。




Fioccola, et al.         Expires March 18, 2022                [Page 19]

Internet-Draft                  IPv6 AMM                  September 2021


      Hex Value    Binary Value      Description           Reference
                   act chg rest
      ----------------------------------------------------------------
      TBD          00   0  tbd       AltMark               [This draft]

8.致谢

  作者要感谢Bob Hinden，Ole Troan，Martin
Duke，Lars Eggert，Roman Danyliw，Alvaro
Retana，Eric Vyncke，Warren
Kumari，Benjamin Kaduk，Stewart
Bryant，Christopher Wood，Yoshifumi
Nishida，Tom Herbert，Stefano
Previdi，Brian木匠，Greg Mirsky，Ron
Bonica为珍贵的评论和建议。

9.参考资料

9.1。规范参考文献

  [RFC2119]
Bradner，S.，“RFC中使用的关键词”，指示要求水平“，BCP
14，RFC 2119，DOI 10.17487 /
RFC2119，1997，<https://www.rfc-
editor.org/info/RFC2119>。

  [rfc8174] leiba，b。，“大写的”ampiguity在RFC
2119中的小写“，BCP 14，RFC 8174，DOI 10.17487 /
RFC8174，2017年5月，<https://www.rfc-
editor.org/info/RFC8174>。

  [rfc8200] Deering，S.和R.
Hinden，“Internet协议，第6版（IPv6）规范”，STD
86，RFC 8200，DOI 10.17487 /
RFC8200，2017年7月，<https://www.rfc-
editor.org/ info / rfc8200>。

9.2。信息参考资料

  [id.chen-pce-pcep-
ifit]元，H.，Zhou，T.，Li，W.，Fioccola，G.和Y. W
ang，“路径计算元素通信协议（PCEP）扩展，以实现IFIT”，草案陈氏PCE
-PCEP-IFIT-04（正在进行的工作），7月2021年。

  [id.fz-spring-srv6-alt-mark]
Fioccola，G.，Zhou，T.和M.
Cociglio，“用于替代标记方法的段路由报头封装”，起草 -  FZ-
Spring-SRV6-Alt-art-01（正在进行的工作），7月2021年。







Fioccola, et al.         Expires March 18, 2022                [Page 20]

Internet-Draft                  IPv6 AMM                  September 2021

  [id.hinden-6man-hbh-
processical]汉登，rm和g.
fairhurst，“IPv6跳跃期权加工程序”，草案 - 海滨6man-
hbh-处理-01（正在进行中），6月2021年。

  [ID.IETF-IDR-SR-POLICY-
IFIT]秦，F.，元，H.，周，T.，FIOCCORA，G.和Y.
WANG，“BGP SR政策延长，使IFIT”，草案 - IETF-IDR-
SR-Policy-IFIT-02（正在进行的工作），7月2021年。

  [id.peng-v6ops-
hbh]彭，s。，李，z.，谢，c。，秦，z.和g.
mishra，“加工跳跃期权标题”，草稿 - 彭 -  v6ops-
hbh-06（正在进行的工作），8月2021。

  [rfc4291] Hinden，R.和S.
Deering，“IP版6名寻址架构”，RFC 4291，DOI
10.17487 /
RFC4291，2006年2月，<https://www.rfc-
editor.org/info/rfc4291>。

  [RFC4301]肯特，S.和K.SEO，SEO，“Internet协议的安
全架构”，RFC 4301，DOI 10.17487 /
RFC4301，2005年12月，<https://www.rfc-
editor.org/info/rfc4301>。

  [RFC6437]
Amante，S.，Carpenter，B.，Jiang，S.和J.
Rajahalme，“IPv6流标本规范”，RFC 6437，DOI
10.17487 /
RFC6437，2011年11月，<HTTPS：//www.RFC-
editor.org/info/rfc6437>>。

  [RFC6438] Carpenter，B.和S.Amante，“使用IPv
6流标签进行同等成本的多路径路由和隧道中的链路聚合”，RFC 6438，DOI
10.17487 /
RFC6438，2011年11月，<https：//www.rfc-
editor.org/info/rfc6438>>。

[RFC7045]木匠，B.和S.江，“IPv6延伸标题的传输和处理”，RFC
7045，DOI 10.17487 /
RFC7045，2013年12月，<https://www.rfc-
editor.org/info/rfc7045>。

  [rfc7384]
Mizrahi，T.，“数据包交换网络中的时间协议的安全要求”，RFC
7384，DOI 10.17487 /
RFC7384，2014年10月，<https://www.rfc-
editor.org/info/rfc7384>。

  [rfc8321] Fioccola，G.，Ed。，Capello，A.，C
ociglio，M.，Castaldelli，L.，Chen，M.，Zheng，
L.，Mirsky，G.和T.
Mizrahi，“替代标记用于被动和混合性能监测的方法“，RFC
8321，DOI 10.17487 /
RFC8321，2018年1月，<https://www.rfc-
editor.org/info/rfc8321>。




Fioccola, et al.         Expires March 18, 2022                [Page 21]

Internet-Draft                  IPv6 AMM                  September 2021

  [RFC8754] Filsfils，C.，Ed。，Dukes，D.，Ed。
，Previdi，S.，Lieddy，J.，Matsushima，S.和D.Vo
yer，“IPv6段路由标题（SRH）”，RFC8754，DOI
10.17487 /
RFC8754，3月20日，<https://www.rfc-
editor.org/info/rfc8754>。

  [RFC8799]木匠，B.和B.刘，“有限域名和互联网协议”，RFC
8799，DOI 10.17487 /
RFC8799，7月20日，<https://www.rfc-
editor.org/info/rfc8799>。

  [RFC8889]
FIOCCORA，G.，ED。，COCIGLIO，M.，SAPIO，A.和R.
SISTO，“被动和混合性能监测的多点替代标记方法”，RFC 8889，DOI
10.17487 /
RFC8889，8月20日，<https://www.rfc-
editor.org/info/rfc8889>。

  [RFC8915] Franke，D.，Sibold，D.，Teichel，
K.，Dansarie，M.和R.
Sundblad，“网络时间协议的网络时间安全”，RFC 8915，DOI
10.17487 /
RFC8915，9月20日，<https://www.rfc-
editor.org/info/rfc8915>。

  作者的地址

  Giuseppe Fioccola Huawei
Risstrasse，25慕尼黑80992德国

  Email : Giuseppe.F IOC cola@华为.com

  TI安然Zhou hu A为 156 be i青RD. Beijing
100095 China

  Email : 周恬然@华为.com

  Mauro Cociglio Telecom Italia通过Reiss
Romoli，274111148意大利

  Email : Mauro.co次给力哦@telecom Italia.IT




Fioccola, et al.         Expires March 18, 2022                [Page 22]

Internet-Draft                  IPv6 AMM                  September 2021

  Fe ng为q in China Mobile 32 X u按五门吸ave.
Beijing 100032 China

  Email : 琴凤尾@China Mobile.com

  ran pang China ucom 9 shout i south
RD. Beijing 100089 China

  Email : 庞然@China ucom.才能



































Fioccola, et al.         Expires March 18, 2022                [Page 23]


